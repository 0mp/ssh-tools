#!/bin/bash

  BLACK=$(tput setaf 1)
    RED=$(tput setaf 1)
  GREEN=$(tput setaf 2)
 YELLOW=$(tput setaf 3)
   BLUE=$(tput setaf 4)
MAGENTA=$(tput setaf 5)
   CYAN=$(tput setaf 6)
  WHITE=$(tput setaf 7)
   BOLD=$(tput bold   )
  RESET=$(tput sgr0   )

ssh_opts=(
    -o BatchMode=yes
    -o CheckHostIP=no
    -o StrictHostKeyChecking=no
    -o HashKnownHosts=no
    -o ConnectTimeout=16
)

if [[ $1 == *"@"* ]]; then
  SERVER=$( echo ${1##*@} )
else
  SERVER=${1}
fi

ssh_seq=1

echo "${BOLD}SSHPING${RESET} ${YELLOW}${SERVER}${RESET}"

while true
  do
    status=$(/usr/bin/ssh "${ssh_opts[@]}" "$@" echo pong 2>&1 | grep -oE 'pong|denied')

    if [[ $status == pong ]] ; then
      echo "${GREEN}Pong${RESET} ${WHITE}from${RESET} ${YELLOW}${SERVER}${RESET}${WHITE}: ssh_seq${RESET}=${RED}${ssh_seq}${RESET}"
    elif [[ $status == denied ]] ; then
      echo "${CYAN}Reply${RESET} ${WHITE}from${RESET} ${YELLOW}${SERVER}${RESET}${WHITE}: ssh_seq${RESET}=${RED}${ssh_seq}${RESET}"
    fi

    ssh_seq=$((ssh_seq+1))
    sleep 1

done
